<!DOCTYPE html>
<html>
  <head>
    <title>Taser Chess</title>
    <link rel="shortcut icon" href="img/icon.png" />
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>

    <!-- CSS --> 
    <link rel="stylesheet" href="css/chessboard-1.0.0.min.css">
    <link rel="stylesheet" href="css/style.css">
    
    <!-- Javascript --> 
    <script src="js/chessboard-1.0.0.min.js"></script>
    <script src="js/chess.js"></script>
    <script src="js/chessAI.js"></script>
    <script src="js/main.js"></script>
  
  </head>
  <body>
    <div class="sidebar">
      <img class="start-logo" src="img/logo_full.png" onclick="mainButton();"></img>
      <p class="credit-text">A (very) dumb project by DucksIncoming</p>
      <div class="whitespace"></div>
      <p class="buttons-text" onclick="rules();">Rules/Explanation</p>
      <p class="buttons-text" onclick="setup();">Setup</p>
      <p class="buttons-text" onclick="video();">Video</p>
    </div>
    <div class="board-container" id="board-container">
      <div id="board" class="board"></div>
    </button>
    <!-- <button id="startButton" class="button-start">Start Game</button> --> 
    <script>
      
      
      var config = {
        draggable: true,
        position: 'start',
        dropOffBoard: 'snapback',
        onDrop: onDrop,
        sparePieces: false,
      }

      function removeGreySquares () {
        $('#board .square-55d63').css('background', '')
      }

      function greySquare (square) {
        var $square = $('#board .square-' + square)

        var background = whiteSquareGrey
        if ($square.hasClass('black-3c85d')) {
          background = blackSquareGrey
        }

        $square.css('background', background)
      }

      var board = null
      
      var game = new Chess()
      var $status = $('#status')
      var $fen = $('#fen')
      var $pgn = $('#pgn')
      var whiteSquareGrey = '#a9a9a9';
      var blackSquareGrey = '#696969';

      function onDragStart (source, piece, position, orientation) {
        // do not pick up pieces if the game is over
        if (game.game_over()) return false

        // only pick up pieces for the side to move
        if ((game.turn() === 'w' && piece.search(/^b/) !== -1) ||
            (game.turn() === 'b' && piece.search(/^w/) !== -1)) {
          return false
        }
      }

      function onDrop (source, target) {
        // see if the move is legal
        var move = game.move({
          from: source,
          to: target,
          promotion: 'q' // NOTE: always promote to a queen for example simplicity
        })

        // illegal move
        if (move === null) return 'snapback'

        updateStatus();
        

        sfxRandomizer = Math.floor(Math.random() * 8) + 1;
        switch (sfxRandomizer) {
          case 1:
            var moveAudio = new Audio('sfx/move1.wav');
            break;
          case 2:
            var moveAudio = new Audio('sfx/move2.wav');
            break;
          case 3:
            var moveAudio = new Audio('sfx/move3.wav');
            break;
          case 4:
            var moveAudio = new Audio('sfx/move4.wav');
            break;
          case 5:
            var moveAudio = new Audio('sfx/move5.wav');
            break;
          case 6:
            var moveAudio = new Audio('sfx/move6.wav');
            break;
          case 7:
            var moveAudio = new Audio('sfx/move7.wav');
            break;
          case 8:
            var moveAudio = new Audio('sfx/move8.wav');
            break;
          default:
            var moveAudio = new Audio('sfx/move1.wav');
            break;
        }
        moveAudio.play();
      }

      function onMouseoverSquare (square, piece) {
      // get list of possible moves for this square
      var moves = game.moves({
        square: square,
        verbose: true
      })

      // exit if there are no moves available for this square
      if (moves.length === 0) return

      // highlight the square they moused over
      greySquare(square)

      // highlight the possible squares for this piece
      for (var i = 0; i < moves.length; i++) {
        greySquare(moves[i].to)
      }
    }

    function onMouseoutSquare (square, piece) {
      removeGreySquares()
    }

      // update the board position after the piece snap
      // for castling, en passant, pawn promotion
      function onSnapEnd () {
        board.position(game.fen());

        evaluate();
      }

      function updateStatus () {
        var status = ''
        gradient = document.getElementById("board-container");

        var moveColor = 'White'
        if (game.turn() === 'b') {
          moveColor = 'Black'
          gradient.style["background-image"] = "linear-gradient(#A3A3A3, #272522 30%)";
        }
        else {
          gradient.style["background-image"] = "linear-gradient(#272522 70%, #A3A3A3)";
        }

        // checkmate?
        if (game.in_checkmate()) {
          status = 'Game over, ' + moveColor + ' is in checkmate.'

          if (moveColor == "White"){
            var endSound = new Audio("sfx/lose.wav");
            playerLose();
          }
          else {
            var endSound = new Audio("sfx/win.wav");
            playerWin();
          }

          endSound.play();
        }

        // draw?
        else if (game.in_draw()) {
          status = 'Game over, drawn position'
          var endSound = new Audio("sfx/draw.wav");
          endSound.play();
        }

        // game still on
        else {
          status = moveColor + ' to move'

          // check?
          if (game.in_check()) {
            status += ', ' + moveColor + ' is in check'
            var checkSound = new Audio("sfx/check.wav");
            checkSound.play();
          }
        }

        $status.html(status)
        $fen.html(game.fen())
        $pgn.html(game.pgn())
      }

      var config = {
        draggable: true,
        position: 'start',
        onDragStart: onDragStart,
        onDrop: onDrop,
        onSnapEnd: onSnapEnd
      }
      board = Chessboard('board', config)

      updateStatus()
    </script>
  </body>
</html>